{
	"version": "2.0.0",
	"tasks": [
		{
			"label": "Stop Foundry VTT",
			"type": "shell",
			"command": "Stop-Process -Name 'FoundryVTT' -Force -ErrorAction SilentlyContinue; exit 0",
			"group": "build"
		},
		{
			"label": "Copy to Foundry",
			"type": "shell",
			"command": "node scripts/build-css.js; if ($LASTEXITCODE -ne 0) { exit 1 }; Remove-Item -Path 'C:\\FoundryVTT\\Data\\systems\\dolmenwood' -Recurse -Force -ErrorAction SilentlyContinue; New-Item -ItemType Directory -Force -Path 'C:\\FoundryVTT\\Data\\systems\\dolmenwood' | Out-Null; Get-ChildItem -Path . -Exclude '.*', 'node_modules', 'scripts' | Copy-Item -Destination 'C:\\FoundryVTT\\Data\\systems\\dolmenwood' -Recurse -Force -ErrorAction SilentlyContinue; node scripts/patch-system-json.js 'C:\\FoundryVTT\\Data\\systems\\dolmenwood\\system.json'",
			"group": "build"
		},
		{
			"label": "FVTT Pack - Pack",
			"type": "shell",
			"command": "$packs = Get-ChildItem -Path packs -Directory | Select-Object -ExpandProperty Name; fvtt package workon dolmenwood --type System; foreach ($pack in $packs) { fvtt package pack $pack }",
			"group": "build"
		},
		{
			"label": "Start Foundry VTT",
			"type": "shell",
			"command": "Start-Process 'C:\\FoundryVTT\\FoundryVTT.exe' -ArgumentList '--port=443'",
			"group": "build"
		},
		{
			"label": "FVTT Pack - Unpack + Sync",
			"type": "shell",
			"command": "$packs = Get-ChildItem -Path packs -Directory | Select-Object -ExpandProperty Name; fvtt package workon dolmenwood --type System; foreach ($pack in $packs) { fvtt package unpack $pack }; Copy-Item -Path 'C:\\FoundryVTT\\Data\\systems\\dolmenwood\\packs\\*' -Destination 'packs' -Recurse -Force",
			"group": "build"
		},
		{
			"label": "Deploy to Foundry",
			"type": "shell",
			"command": "echo 'Deploy sequence started'",
			"dependsOn": [
				"Stop Foundry VTT",
				"Copy to Foundry",
				"FVTT Pack - Pack",
				"Start Foundry VTT"
			],
			"dependsOrder": "sequence",
			"group": {
				"kind": "build",
				"isDefault": true
			}
		}
	]
}
