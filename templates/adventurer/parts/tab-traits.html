<section class="tab-content tab-traits {{tab.cssClass}}" data-group="primary" data-tab="traits">
	{{#if isKindredClass}}
	<!-- Kindred-Class Traits (replaces both kindred and class traits) -->
	<section class="kindred-class-traits boxed-section">
		<h2>{{kindredClassName}} {{localize "DOLMEN.Traits.Title"}}</h2>
		<section class="two-columns traits-grid">
			{{#each kindredClassTraits}}
			<section class="trait boxed-section {{this.traitType}}" data-trait-id="{{this.id}}">
				<h3>
					{{this.name}}
					{{#if this.value}}
					<span class="trait-value">{{this.value}}</span>
					{{/if}}
					{{#if this.rollable}}
					<i class="fa fa-dice-d20 rollable" data-trait-id="{{this.id}}" data-roll-formula="{{this.rollFormula}}" data-trait-name="{{this.name}}" data-roll-target="{{this.rollTarget}}"></i>
					{{/if}}
				</h3>
				<p>{{this.description}}</p>
				{{#if this.hasUsageTracking}}
				<div class="trait-usage">
					<span class="usage-label">{{this.usageFrequency}}:</span>
					<div class="usage-checkboxes">
						{{#each this.usageCheckboxes}}
						<input type="checkbox" class="trait-usage-checkbox" data-trait-id="{{../id}}" data-usage-index="{{this.index}}" data-max-uses="{{../maxUses}}" {{#if this.checked}}checked{{/if}}>
						{{/each}}
					</div>
					<span class="uses-remaining">({{this.usesRemaining}} {{localize "DOLMEN.Traits.Remaining"}})</span>
				</div>
				{{/if}}
			</section>
			{{/each}}
		</section>
	</section>
	{{else}}
	<!-- Kindred Traits -->
	<section class="kindred-traits boxed-section">
		<h2>{{kindredName}} {{localize "DOLMEN.Traits.Title"}}</h2>
		<section class="two-columns traits-grid">
			{{#each kindredTraits}}
			<section class="trait boxed-section {{this.traitType}}" data-trait-id="{{this.id}}">
				<h3>
					{{this.name}}
					{{#if this.value}}
					<span class="trait-value">{{this.value}}</span>
					{{/if}}
					{{#if this.rollable}}
					<i class="fa fa-dice-d20 rollable" data-trait-id="{{this.id}}" data-roll-formula="{{this.rollFormula}}" data-trait-name="{{this.name}}" data-roll-target="{{this.rollTarget}}"></i>
					{{/if}}
				</h3>
				<p>{{this.description}}</p>
				{{#if this.hasUsageTracking}}
				<div class="trait-usage">
					<span class="usage-label">{{this.usageFrequency}}:</span>
					<div class="usage-checkboxes">
						{{#each this.usageCheckboxes}}
						<input type="checkbox" class="trait-usage-checkbox" data-trait-id="{{../id}}" data-usage-index="{{this.index}}" data-max-uses="{{../maxUses}}" {{#if this.checked}}checked{{/if}}>
						{{/each}}
					</div>
					<span class="uses-remaining">({{this.usesRemaining}} {{localize "DOLMEN.Traits.Remaining"}})</span>
				</div>
				{{/if}}
			</section>
			{{/each}}
		</section>
	</section>

	<!-- Class Traits -->
	<section class="class-traits boxed-section">
		<h2>{{className}} {{localize "DOLMEN.Traits.Title"}}</h2>
		<section class="two-columns traits-grid">
			{{#each classTraits}}
			<section class="trait boxed-section {{this.traitType}}" data-trait-id="{{this.id}}">
				<h3>
					{{this.name}}
					{{#if this.value}}
					<span class="trait-value">{{this.value}}</span>
					{{/if}}
					{{#if this.rollable}}
					<i class="fa fa-dice-d20 rollable" data-trait-id="{{this.id}}" data-roll-formula="{{this.rollFormula}}" data-trait-name="{{this.name}}" data-roll-target="{{this.rollTarget}}"></i>
					{{/if}}
				</h3>
				{{#if this.requiresHolyOrder}}
				<div class="order-select">
					<select name="system.holyOrder">
						{{selectOptions @root.holyOrderChoices selected=@root.system.holyOrder}}
					</select>
					{{#if this.holyOrderDesc}}
					<p class="order-description">{{this.holyOrderDesc}}</p>
					{{/if}}
				</div>
				{{else}}
				<p>{{this.description}}</p>
				{{/if}}
				{{#if this.hasUsageTracking}}
				<div class="trait-usage">
					<span class="usage-label">{{this.usageFrequency}}:</span>
					<div class="usage-checkboxes">
						{{#each this.usageCheckboxes}}
						<input type="checkbox" class="trait-usage-checkbox" data-trait-id="{{../id}}" data-usage-index="{{this.index}}" data-max-uses="{{../maxUses}}" {{#if this.checked}}checked{{/if}}>
						{{/each}}
					</div>
					<span class="uses-remaining">({{this.usesRemaining}} {{localize "DOLMEN.Traits.Remaining"}})</span>
				</div>
				{{/if}}
			</section>
			{{/each}}
		</section>
	</section>

	<!-- Combat Talents Selection (if class has combat talents feature) -->
	{{#if hasCombatTalents}}
	<section class="combat-talents-selection boxed-section">
		<h2>{{localize "DOLMEN.Traits.CombatTalents"}}</h2>
		<div class="talents-list">
			{{#each system.combatTalents}}
			<div class="talent-entry">
				<select name="system.combatTalents.{{@index}}">
					{{selectOptions @root.combatTalentChoices selected=this}}
				</select>
			</div>
			{{/each}}
			{{#if (lt system.combatTalents.length 4)}}
			<div class="add-talent-hint">
				<small>{{localize "DOLMEN.Traits.TalentsGainedHint"}}</small>
			</div>
			{{/if}}
		</div>
	</section>
	{{/if}}
	{{/if}}
</section>